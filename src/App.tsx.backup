import { useContext } from 'preact/compat';
import { LocationProvider, Router, Route } from 'preact-iso';
import { Theme } from './ThemeProvider';
import { Button, Typography, Hamburger } from './ui';
import { ErrorBoundary } from './components/ErrorBoundary';
import { Home, Settings, About, NotFound } from './pages';
import { themeSignal, isMobileMenuOpenSignal } from './application/signals';

import './App.scss';

function App() {
  const context = useContext(Theme);
  if (!context) {
    throw new Error('App must be used within ThemeProvider');
  }
  const { setTheme, nextTheme } = context;

  const handleThemeToggle = () => {
    const currentTheme = themeSignal.value;
    const newTheme = nextTheme(currentTheme);
    themeSignal.value = newTheme;
    setTheme(newTheme);
  };

  const toggleMobileMenu = () => {
    isMobileMenuOpenSignal.value = !isMobileMenuOpenSignal.value;
  };

  const closeMobileMenu = () => {
    isMobileMenuOpenSignal.value = false;
  };

  return (
    <div className="app-wrapper">
      {/* Professional Header with Hamburger */}
      <header className="app-header">
        <div className="app-header__container">
          <div className="app-header__left">
            <Hamburger
              isOpen={isMobileMenuOpen}
              onClick={toggleMobileMenu}
              ariaLabel="Toggle navigation menu"
            />
            <Typography variant="h1" className="app-header__title">
              Preact Training
            </Typography>
          </div>
          <nav className="app-header__nav">
            <Button
              variant="secondary"
              size="md"
              onClick={handleThemeToggle}
              className="app-header__theme-btn"
            >
              {theme === 'light' ? 'üåô' : '‚òÄÔ∏è'} {theme}
            </Button>
          </nav>
        </div>
      </header>

      {/* Mobile Sidebar Overlay */}
      {isMobileMenuOpen && (
        <div className="app-mobile-overlay" onClick={closeMobileMenu} />
      )}

      {/* Main Layout Container */}
      <div className="app-container">
        {/* Aside Navigation */}
        <aside
          className={`app-aside ${isMobileMenuOpen ? 'app-aside--open' : ''}`}
        >
          <Card
            variant="elevated"
            shadow="light"
            size="lg"
            className="app-aside__card"
          >
            <Typography variant="h3" gutterBottom>
              Quick Actions
            </Typography>
            <Grid direction="column" gap="lg">
              <Button
                variant="primary"
                size="lg"
                onClick={() => {
                  handleThemeToggle();
                  closeMobileMenu();
                }}
              >
                Toggle Theme ({nextTheme(theme)})
              </Button>
              <Button variant="success" size="md" disabled>
                Coming Soon
              </Button>
              <Button variant="danger" size="md" disabled>
                Disabled Action
              </Button>
            </Grid>
          </Card>

          <Card
            variant="elevated"
            shadow="medium"
            size="lg"
            className="app-aside__card"
          >
            <Typography variant="h4" gutterBottom>
              System Info
            </Typography>
            <Typography variant="body2" color="secondary" gutterBottom>
              Theme: {theme}
            </Typography>
            <Typography variant="caption" color="tertiary" gutterBottom>
              Components: Grid, Card, Button, Typography, Hamburger
            </Typography>
            <Typography variant="caption" color="tertiary" gutterBottom>
              Framework: Preact + TypeScript
            </Typography>
          </Card>
        </aside>

        {/* Main Content */}
        <main className="app-main">
          {/* Dashboard Header */}
          <section className="app-content">
            <Card variant="elevated" shadow="none" size="xl">
              <Typography variant="h2" gutterBottom>
                Analytics Dashboard
              </Typography>
              <Typography variant="body1" color="secondary" gutterBottom>
                Real-time performance metrics and key business indicators
              </Typography>
              <div
                style={{
                  marginTop: '1rem',
                  display: 'flex',
                  gap: '1.5rem',
                  flexWrap: 'wrap',
                }}
              >
                <div>
                  <Typography variant="caption" color="tertiary">
                    Last updated
                  </Typography>
                  <Typography variant="body2">2 minutes ago</Typography>
                </div>
                <div>
                  <Typography variant="caption" color="tertiary">
                    Reporting Period
                  </Typography>
                  <Typography variant="body2">Nov 1-17, 2025</Typography>
                </div>
                <div>
                  <Typography variant="caption" color="tertiary">
                    Data Source
                  </Typography>
                  <Typography variant="body2">Production Database</Typography>
                </div>
              </div>
            </Card>
          </section>

          {/* Metrics Grid */}
          <section className="app-metrics">
            <Grid direction="row" gap="lg">
              <Card
                variant="elevated"
                shadow="none"
                size="md"
                style={{ flex: '1 1 250px' }}
              >
                <Typography variant="h4" color="tertiary" gutterBottom>
                  Total Revenue
                </Typography>
                <Typography variant="h2" gutterBottom>
                  $142,850
                </Typography>
                <Typography variant="body2" color="success">
                  +12.5% from last month
                </Typography>
              </Card>

              <Card
                variant="elevated"
                shadow="none"
                size="md"
                style={{ flex: '1 1 250px' }}
              >
                <Typography variant="h4" color="tertiary" gutterBottom>
                  Active Users
                </Typography>
                <Typography variant="h2" gutterBottom>
                  8,249
                </Typography>
                <Typography variant="body2" color="success">
                  +8.2% from last month
                </Typography>
              </Card>

              <Card
                variant="elevated"
                shadow="none"
                size="md"
                style={{ flex: '1 1 250px' }}
              >
                <Typography variant="h4" color="tertiary" gutterBottom>
                  Conversion Rate
                </Typography>
                <Typography variant="h2" gutterBottom>
                  3.24%
                </Typography>
                <Typography variant="body2" color="error">
                  -2.1% from last month
                </Typography>
              </Card>

              <Card
                variant="elevated"
                shadow="none"
                size="md"
                style={{ flex: '1 1 250px' }}
              >
                <Typography variant="h4" color="tertiary" gutterBottom>
                  Avg. Order Value
                </Typography>
                <Typography variant="h2" gutterBottom>
                  $89.42
                </Typography>
                <Typography variant="body2" color="success">
                  +5.8% from last month
                </Typography>
              </Card>
            </Grid>
          </section>

          {/* Recent Activity */}
          <section className="app-demo">
            <Card variant="elevated" shadow="none" size="xl">
              <Typography variant="h3" gutterBottom>
                Recent Activity
              </Typography>
              <Typography variant="body2" color="secondary" gutterBottom>
                Latest transactions and system events
              </Typography>

              <div style={{ marginTop: '1rem' }}>
                <Grid direction="column" gap="sm">
                  <Card variant="outlined" shadow="none" size="sm">
                    <Typography variant="body2" gutterBottom>
                      <strong>New order #4829</strong> received from Enterprise
                      Client
                    </Typography>
                    <Typography variant="caption" color="tertiary">
                      2 minutes ago ¬∑ Order Management
                    </Typography>
                  </Card>

                  <Card variant="outlined" shadow="none" size="sm">
                    <Typography variant="body2" gutterBottom>
                      <strong>Payment processed:</strong> $2,450.00 via Stripe
                    </Typography>
                    <Typography variant="caption" color="tertiary">
                      15 minutes ago ¬∑ Finance
                    </Typography>
                  </Card>

                  <Card variant="outlined" shadow="none" size="sm">
                    <Typography variant="body2" gutterBottom>
                      <strong>User registration:</strong> 3 new accounts created
                    </Typography>
                    <Typography variant="caption" color="tertiary">
                      32 minutes ago ¬∑ User Management
                    </Typography>
                  </Card>

                  <Card variant="outlined" shadow="none" size="sm">
                    <Typography variant="body2" gutterBottom>
                      <strong>Report generated:</strong> Monthly analytics Q4
                      2025
                    </Typography>
                    <Typography variant="caption" color="tertiary">
                      45 minutes ago ¬∑ Reports
                    </Typography>
                  </Card>

                  <Card variant="outlined" shadow="none" size="sm">
                    <Typography variant="body2" gutterBottom>
                      <strong>System backup completed</strong> successfully
                    </Typography>
                    <Typography variant="caption" color="tertiary">
                      1 hour ago ¬∑ System
                    </Typography>
                  </Card>
                </Grid>
              </div>
            </Card>
          </section>

          {/* Team Performance */}
          <section className="app-team">
            <Card variant="elevated" shadow="none" size="xl">
              <Typography variant="h3" gutterBottom>
                Team Performance
              </Typography>
              <Typography variant="body2" color="secondary" gutterBottom>
                Top performing team members this month
              </Typography>

              <div style={{ marginTop: '1rem' }}>
                <Grid direction="column" gap="sm">
                  <div
                    style={{
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center',
                      padding: '0.75rem 0',
                      borderBottom:
                        '1px solid rgba(var(--pta-color-border-rgb, 0, 0, 0), 0.08)',
                    }}
                  >
                    <div>
                      <Typography variant="body1" gutterBottom>
                        Sarah Johnson
                      </Typography>
                      <Typography variant="caption" color="tertiary">
                        Senior Sales Manager
                      </Typography>
                    </div>
                    <div style={{ textAlign: 'right' }}>
                      <Typography variant="body1" gutterBottom>
                        $45,200
                      </Typography>
                      <Typography variant="caption" color="success">
                        +18.5%
                      </Typography>
                    </div>
                  </div>

                  <div
                    style={{
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center',
                      padding: '0.75rem 0',
                      borderBottom:
                        '1px solid rgba(var(--pta-color-border-rgb, 0, 0, 0), 0.08)',
                    }}
                  >
                    <div>
                      <Typography variant="body1" gutterBottom>
                        Michael Chen
                      </Typography>
                      <Typography variant="caption" color="tertiary">
                        Account Executive
                      </Typography>
                    </div>
                    <div style={{ textAlign: 'right' }}>
                      <Typography variant="body1" gutterBottom>
                        $38,900
                      </Typography>
                      <Typography variant="caption" color="success">
                        +15.2%
                      </Typography>
                    </div>
                  </div>

                  <div
                    style={{
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center',
                      padding: '0.75rem 0',
                    }}
                  >
                    <div>
                      <Typography variant="body1" gutterBottom>
                        Emily Rodriguez
                      </Typography>
                      <Typography variant="caption" color="tertiary">
                        Business Development
                      </Typography>
                    </div>
                    <div style={{ textAlign: 'right' }}>
                      <Typography variant="body1" gutterBottom>
                        $32,450
                      </Typography>
                      <Typography variant="caption" color="success">
                        +12.8%
                      </Typography>
                    </div>
                  </div>
                </Grid>
              </div>
            </Card>
          </section>

          {/* Action Buttons */}
          <section className="app-actions">
            <Card variant="elevated" shadow="none" size="xl">
              <Typography variant="h3" gutterBottom>
                Quick Actions
              </Typography>
              <div style={{ marginTop: '1rem' }}>
                <Grid direction="row" gap="md">
                  <Button variant="primary" size="md">
                    Generate Report
                  </Button>
                  <Button variant="secondary" size="md">
                    Export Data
                  </Button>
                  <Button variant="success" size="md">
                    New Transaction
                  </Button>
                  <Button variant="secondary" size="md">
                    Settings
                  </Button>
                </Grid>
              </div>
            </Card>
          </section>
        </main>
      </div>

      {/* Footer */}
      <footer className="app-footer">
        <Typography
          variant="caption"
          color="tertiary"
          align="center"
          gutterBottom={false}
        >
          ¬© 2025 Preact Training Application - Built with TypeScript and SCSS
        </Typography>
      </footer>
    </div>
  );
}

export default App;
